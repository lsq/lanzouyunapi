# 蓝奏云解析API
蓝奏云解析，支持获取：文件名、分享者、文件大小、描述、文件链接、文件直链

获取到的链接是临时的下载链接，请按需使用。

要求PHP版本>=7.0。非调试模式建议将第十行代码取消注释。（屏蔽轻微错误）

# 功能
1. 获取文件名、分享者、文件大小、文件描述、文件链接、文件直链、上传时间
2. 重定向
3. 支持带密码文件和带`webpage`参数的文件
4. 支持手机UA和电脑UA获取文件，并且可以进行自动切换
5. 支持缓存链接和验证缓存的链接是否有效
6. 支持多种数据格式响应

# 依赖
## 文件
1. simple_html_dom.php 
2. lanzouyunapiconfig.php 

## 扩展
1. apcu (非必要，如果不需要使用缓存功能)
2. curl (默认自带)

# 使用

## 请求
请求类型：`GET/POST`

请求示例：`lanzouyunapi.php?data=wzdc`
| 参数 | 必填 | 默认 | 说明 |
| -- | -- | -- | -- |
| mode | 否 | pc | 获取数据方式 |
| data | 是 | | 蓝奏云链接或ID |
| pw | 否 | | 密码 |
| types | 否 | json | 返回的数据类型(可选值: text、json、xml) |
| redirect | 否 | 0 | 重定向 |
| link | 否 | 0 | 获取文件直链 |
| auto | 否 | 0 | 自动切换 |


### mode参数说明
> 做两个UA的不同获取方式是因为如果电脑UA获取失败了可以改用手机UA获取（算是备用方案了）

| 参数 | 说明 |
| -- | -- |
| pc | 使用电脑UA获取数据 |
| moblie | 使用手机UA获取数据 |

### redirect和link和auto参数说明
> 重定向：开启重定向(redirect)后，服务器会将获取到的链接进行重定向。如果获取链接失败则会返回错误信息，返回的数据类型由你（传入的types参数）决定。

> 获取文件直链：开启获取直链(link)后，服务器会尝试获取直链，如果失败则会返回原始链接，并告知客户端获取直链失败。(types=text除外）

> 自动切换：例如当使用电脑UA获取链接失败就使用手机UA去获取（先用哪个由你传入的`mode`参数决定

请求示例（开启重定向和获取文件直链）：`lanzouyunapi.php?data=wzdc&redirect=1&link=1`

| 参数 | 说明 |
| -- | -- |
| 1  | 开启 |
| 0  | 关闭 |

## 返回

| 参数 | 说明 | 数据类型 |
| -- | -- | -- |
| code | 状态码 | int |
| msg | 信息 | String |
| data | 文件信息 | object |

### 文件信息
| 参数 | 说明 | 数据类型 |
| -- | -- | -- |
| name | 文件名 | String |
| size | 文件大小 | String |
| user | 分享者 | String |
| desc | 描述 | String |
| time | 上传时间 | String |
| url | 链接 | String |

### 状态码说明
| code | 说明 | msg |
| -- | -- | -- |
| 2 | (部分或全部)数据来自缓存 | 来自缓存 |
| 1 | 已经成功获取链接，但获取直链失败 | 获取直链失败 |
| 0 | 获取成功 | 成功 |
| -1 | 请求接口时，蓝奏云接口返回的错误信息 | （显示蓝奏云返回的错误信息） |
| -2 | 获取网页内容时发生错误，会尝试再次获取蓝奏云提示的错误信息 | （显示获取到的错误信息，如果没有则显示获取失败） |
| -3 | HTML解析错误 | 获取失败 |
| -4 | 缺少参数 | 缺少参数 |
